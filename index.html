<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>DailyDoseofBCA</title>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-base: #000000;
            --accent-blue: #007aff;
            --glass-bg: rgba(255, 255, 255, 0.04);
            --glass-border: rgba(255, 255, 255, 0.1);
            --liquid-blur: blur(45px);
        }

        body {
            background-color: var(--bg-base);
            color: #ffffff;
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", system-ui;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Background Liquid Orbs */
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            opacity: 0.4;
            pointer-events: none;
        }

        /* Glass Panels */
        .liquid-glass {
            background: var(--glass-bg);
            backdrop-filter: var(--liquid-blur);
            -webkit-backdrop-filter: var(--liquid-blur);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }

        .view { position: fixed; inset: 0; display: none; flex-direction: column; z-index: 10; background: black; }
        .view.active { display: flex; }

        .ios-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 18px;
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .ios-input:focus { border-color: var(--accent-blue); background: rgba(255, 255, 255, 0.1); }

        .ios-btn {
            width: 100%;
            background: var(--accent-blue);
            color: white;
            border-radius: 20px;
            padding: 18px;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.2, 1, 0.3, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .ios-btn:active { transform: scale(0.96); opacity: 0.8; }

        /* Slider Engine */
        .slider-viewport { 
            position: relative;
            overflow: hidden;
            width: 100%;
            touch-action: pan-y;
        }
        .slider-track {
            display: flex;
            width: 300%; /* 3 slides */
            height: 100%;
            will-change: transform;
        }
        .slide {
            width: 100vw;
            padding: 0 24px;
            flex-shrink: 0;
            pointer-events: none;
        }
        .slide-content { pointer-events: auto; }

        /* Lift-Up Feel */
        .card-lift {
            transition: all 0.5s cubic-bezier(0.2, 1, 0.3, 1);
            transform-origin: center;
        }
        .card-lift:active {
            transform: scale(1.04) translateY(-10px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            filter: brightness(1.15);
        }

        /* Nav Indicator */
        #nav-indicator {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading .spinner { display: block; }
        .loading .btn-text { display: none; }
    </style>
</head>
<body>

    <!-- Liquid Background Elements -->
    <div class="orb w-[300px] h-[300px] bg-blue-600 top-[-100px] right-[-50px]"></div>
    <div class="orb w-[250px] h-[250px] bg-purple-600 bottom-[-50px] left-[-50px]"></div>

    <!-- AUTHENTICATION VIEW -->
    <div id="view-auth" class="view active items-center justify-center p-8">
        <div class="w-full max-w-[400px] relative z-20">
            <div class="text-center mb-10">
                <h1 id="auth-title" class="text-5xl font-black tracking-tighter mb-2">DailyDoseofBCA</h1>
                <p id="auth-subtitle" class="text-zinc-500 font-medium">BCA class resources all at one place.</p>
            </div>
            
            <div class="space-y-4">
                <input type="text" id="reg-name" class="ios-input hidden" placeholder="What should we call you?">
                <input type="email" id="reg-email" class="ios-input" placeholder="Email Address">
                <input type="password" id="reg-pass" class="ios-input" placeholder="Password">
            </div>

            <button id="btn-auth-submit" class="ios-btn mt-8 shadow-2xl shadow-blue-500/20">
                <span class="btn-text">Continue</span>
                <div class="spinner"></div>
            </button>
            
            <p id="auth-toggle" class="mt-8 text-sm text-center text-zinc-500 font-bold cursor-pointer">New here? <span class="text-blue-500">Sign Up</span></p>
            <p id="auth-msg" class="mt-4 text-xs font-semibold text-center text-red-400 min-h-[1rem]"></p>
        </div>
    </div>

    <!-- SETUP PROFILE PICTURE VIEW -->
    <div id="view-setup-pfp" class="view items-center justify-center p-8">
        <div class="w-full max-w-[400px] text-center relative z-20">
            <h1 class="text-3xl font-black mb-2">Hello, <span id="setup-name-display" class="text-blue-500">Student</span>!</h1>
            <p class="text-zinc-500 mb-10">Add a profile photo to complete your workspace.</p>

            <div class="relative inline-block mb-12">
                <div class="w-32 h-32 rounded-[40px] liquid-glass overflow-hidden p-1">
                    <img id="setup-pfp-preview" src="https://ui-avatars.com/api/?name=User&background=0a84ff&color=fff" class="w-full h-full object-cover rounded-[36px]">
                </div>
                <input type="file" id="setup-pfp-input" class="hidden" accept="image/*">
                <button onclick="document.getElementById('setup-pfp-input').click()" class="absolute -bottom-2 -right-2 bg-blue-600 p-4 rounded-3xl border-4 border-black active:scale-90 transition-transform">
                    <i data-lucide="camera" size="20"></i>
                </button>
            </div>

            <div class="space-y-4">
                <button id="btn-setup-finish" class="ios-btn">Finish Setup</button>
                <button id="btn-setup-skip" class="w-full py-4 text-zinc-500 font-bold text-sm">Skip for now</button>
            </div>
            <p id="setup-msg" class="mt-4 text-xs font-medium text-zinc-500"></p>
        </div>
    </div>

    <!-- MAIN HOME VIEW -->
    <div id="view-home" class="view">
        <header class="pt-20 px-8 pb-4 flex justify-between items-end relative z-20">
            <div>
                <h2 class="text-[10px] font-black text-blue-500 uppercase tracking-widest mb-1">Your Workspace</h2>
                <h1 id="user-display-name" class="text-4xl font-black tracking-tighter">Student</h1>
            </div>
            <button onclick="toggleProfile()" class="active:scale-90 transition-transform">
                <img id="header-avatar" src="" class="w-14 h-14 rounded-2xl liquid-glass object-cover bg-zinc-900">
            </button>
        </header>

        <!-- Touch Interactive Slider -->
        <div class="slider-viewport flex-1 mt-6" id="slider-viewport">
            <div class="slider-track" id="slider-track">
                
                <!-- Slide 1: Notes -->
                <div class="slide">
                    <div class="slide-content">
                        <h3 class="text-xs font-black text-zinc-600 uppercase tracking-[0.2em] mb-6">Learning Materials</h3>
                        <div class="liquid-glass p-8 card-lift mb-6 rounded-[40px] border-white/5">
                            <div class="w-14 h-14 bg-blue-500/10 text-blue-500 rounded-2xl flex items-center justify-center mb-8">
                                <i data-lucide="book-open" size="28"></i>
                            </div>
                            <h4 class="text-2xl font-bold mb-2">Android Labs</h4>
                            <p class="text-zinc-500 text-sm leading-relaxed mb-10">Download the complete semester labs for Practical Exams.</p>
                            <button class="w-full py-4 bg-white text-black rounded-2xl font-black text-sm">View PDF</button>
                        </div>
                    </div>
                </div>

                <!-- Slide 2: Assignments -->
                <div class="slide">
                    <div class="slide-content">
                        <h3 class="text-xs font-black text-zinc-600 uppercase tracking-[0.2em] mb-6">Upcoming Tasks</h3>
                        <div class="liquid-glass p-8 card-lift mb-6 rounded-[40px] border-purple-500/20">
                            <div class="w-14 h-14 bg-purple-500/10 text-purple-500 rounded-2xl flex items-center justify-center mb-8">
                                <i data-lucide="clipboard-list" size="28"></i>
                            </div>
                            <h4 class="text-2xl font-bold mb-2">Web Projects</h4>
                            <p class="text-zinc-500 text-sm leading-relaxed mb-10">React.js state management assignment due on Friday.</p>
                            <button class="w-full py-4 bg-zinc-800 text-white rounded-2xl font-black text-sm border border-white/10">Upload Now</button>
                        </div>
                    </div>
                </div>

                <!-- Slide 3: Resources -->
                <div class="slide">
                    <div class="slide-content">
                        <h3 class="text-xs font-black text-zinc-600 uppercase tracking-[0.2em] mb-6">Quick Tools</h3>
                        <div class="liquid-glass p-8 card-lift mb-6 rounded-[40px] border-green-500/20">
                            <div class="w-14 h-14 bg-green-500/10 text-green-500 rounded-2xl flex items-center justify-center mb-8">
                                <i data-lucide="flask-conical" size="28"></i>
                            </div>
                            <h4 class="text-2xl font-bold mb-2">Lab Manuals</h4>
                            <p class="text-zinc-500 text-sm leading-relaxed mb-10">Official BCA lab manuals for 2024 revised syllabus.</p>
                            <button class="w-full py-4 bg-zinc-800 text-white rounded-2xl font-black text-sm border border-white/10">Explore</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Glass Bottom Nav -->
        <div class="fixed bottom-12 left-0 w-full px-8 z-30 pointer-events-none">
            <nav class="liquid-glass w-full max-w-[400px] mx-auto h-20 rounded-[35px] flex items-center p-2 pointer-events-auto relative">
                <div id="nav-indicator" class="absolute h-16 w-[calc((100%-16px)/3)] rounded-[28px]"></div>
                <div class="flex-1 flex justify-center z-10 cursor-pointer" onclick="jumpToSlide(0)">
                    <i data-lucide="book-open" size="20"></i>
                </div>
                <div class="flex-1 flex justify-center z-10 cursor-pointer opacity-40" onclick="jumpToSlide(1)">
                    <i data-lucide="edit-3" size="20"></i>
                </div>
                <div class="flex-1 flex justify-center z-10 cursor-pointer opacity-40" onclick="jumpToSlide(2)">
                    <i data-lucide="archive" size="20"></i>
                </div>
            </nav>
        </div>
    </div>

    <!-- PROFILE MODAL -->
    <div id="profile-modal" class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-xl flex items-end justify-center" onclick="toggleProfile()">
        <div class="w-full liquid-glass rounded-t-[50px] p-10 animate-slide-up" onclick="event.stopPropagation()">
            <div class="w-12 h-1 bg-white/10 rounded-full mx-auto mb-10"></div>
            
            <div class="flex flex-col items-center mb-12">
                <img id="modal-avatar" src="" class="w-24 h-24 rounded-[32px] object-cover border-2 border-blue-500/30 mb-4 bg-zinc-900">
                <h3 id="profile-name-label" class="text-2xl font-bold">User Name</h3>
                <p id="profile-email-label" class="text-zinc-500 text-sm font-medium">user@email.com</p>
            </div>

            <div class="space-y-4">
                <div class="flex gap-3">
                    <input type="text" id="new-name" class="ios-input flex-1" placeholder="Update display name">
                    <button id="btn-update-name" class="bg-white text-black px-8 rounded-2xl font-bold">Save</button>
                </div>
                <button onclick="handleSignOut()" class="w-full py-5 bg-red-500/10 text-red-500 rounded-3xl font-bold">Sign Out</button>
            </div>
        </div>
    </div>

<script>
    lucide.createIcons();

    // Supabase Setup
    const SB_URL = 'https://nsvkbxssnjjwhsrsxirs.supabase.co'; 
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zdmtieHNzbmpqd2hzcnN4aXJzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0MDA4NzksImV4cCI6MjA4MTk3Njg3OX0.S5GgEm49x6nJFmnOSsFI3Nte-mwNmVUbwTkxqa8h3yE';
    const _supabase = supabase.createClient(SB_URL, SB_KEY);

    const views = {
        auth: document.getElementById('view-auth'),
        setup: document.getElementById('view-setup-pfp'),
        home: document.getElementById('view-home')
    };

    let isLoginMode = true;
    let currentSlide = 0;
    const totalSlides = 3;

    // --- LIQUID SWIPE ENGINE ---
    const track = document.getElementById('slider-track');
    const viewport = document.getElementById('slider-viewport');
    let startX = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    let isDragging = false;
    let animationID = 0;

    viewport.addEventListener('touchstart', (e) => {
        isDragging = true;
        startX = e.touches[0].clientX;
        track.style.transition = 'none';
        animationID = requestAnimationFrame(animateSwipe);
    });

    viewport.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        const currentX = e.touches[0].clientX;
        const diff = currentX - startX;
        currentTranslate = prevTranslate + diff;
    });

    viewport.addEventListener('touchend', () => {
        isDragging = false;
        cancelAnimationFrame(animationID);
        
        const movedBy = currentTranslate - prevTranslate;
        if (movedBy < -100 && currentSlide < totalSlides - 1) currentSlide++;
        else if (movedBy > 100 && currentSlide > 0) currentSlide--;

        jumpToSlide(currentSlide);
    });

    function animateSwipe() {
        track.style.transform = `translateX(${currentTranslate}px)`;
        if (isDragging) requestAnimationFrame(animateSwipe);
    }

    function jumpToSlide(index) {
        currentSlide = index;
        const width = window.innerWidth;
        currentTranslate = index * -width;
        prevTranslate = currentTranslate;
        
        track.style.transition = 'transform 0.7s cubic-bezier(0.16, 1, 0.3, 1)';
        track.style.transform = `translateX(${currentTranslate}px)`;
        
        // UI Navigation Update
        const navIcons = document.querySelectorAll('nav div:not(#nav-indicator)');
        navIcons.forEach((el, i) => el.style.opacity = (i === index ? '1' : '0.4'));
        document.getElementById('nav-indicator').style.transform = `translateX(${index * 100}%)`;
    }

    // --- AUTHENTICATION ---
    document.getElementById('auth-toggle').onclick = () => {
        isLoginMode = !isLoginMode;
        document.getElementById('auth-title').innerText = isLoginMode ? "DailyDose" : "Join Us";
        document.getElementById('auth-toggle').innerHTML = isLoginMode ? 'New here? <span class="text-blue-500">Sign Up</span>' : 'Already have an account? <span class="text-blue-500">Log In</span>';
        document.getElementById('reg-name').classList.toggle('hidden', isLoginMode);
    };

    document.getElementById('btn-auth-submit').onclick = async () => {
        const btn = document.getElementById('btn-auth-submit');
        const email = document.getElementById('reg-email').value.trim();
        const password = document.getElementById('reg-pass').value;
        const name = document.getElementById('reg-name').value.trim();
        const msg = document.getElementById('auth-msg');

        if (!email || !password || (!isLoginMode && !name)) {
            msg.innerText = "Please fill all fields.";
            return;
        }

        btn.classList.add('loading');
        msg.innerText = "";

        if (isLoginMode) {
            const { error } = await _supabase.auth.signInWithPassword({ email, password });
            if (error) { msg.innerText = error.message; btn.classList.remove('loading'); }
        } else {
            const { data, error } = await _supabase.auth.signUp({
                email, password,
                options: { data: { full_name: name, profile_changes_left: 5 } }
            });
            if (error) { msg.innerText = error.message; btn.classList.remove('loading'); }
            else if (!data.session) { msg.innerText = "Please verify your email!"; btn.classList.remove('loading'); }
        }
    };

    // --- SETUP PROFILE ---
    document.getElementById('setup-pfp-input').onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => document.getElementById('setup-pfp-preview').src = ev.target.result;
            reader.readAsDataURL(file);
        }
    };

    document.getElementById('btn-setup-finish').onclick = async () => {
        const file = document.getElementById('setup-pfp-input').files[0];
        if (!file) return alert("Please select a photo.");

        const btn = document.getElementById('btn-setup-finish');
        btn.innerText = "Uploading...";
        
        const { data: { user } } = await _supabase.auth.getUser();
        const path = `avatars/${user.id}-${Date.now()}`;
        
        await _supabase.storage.from('avatars').upload(path, file);
        const { data: { publicUrl } } = _supabase.storage.from('avatars').getPublicUrl(path);
        
        await _supabase.auth.updateUser({ data: { avatar_url: publicUrl } });
        location.reload();
    };

    document.getElementById('btn-setup-skip').onclick = () => setView('home');

    // --- SESSION MGMT ---
    _supabase.auth.onAuthStateChange(async (event, session) => {
        if (session) {
            const user = session.user;
            const meta = user.user_metadata || {};
            const userName = meta.full_name || "Student";

            // If no avatar and we are not in home view, show setup
            if (!meta.avatar_url && !views.home.classList.contains('active')) {
                document.getElementById('setup-name-display').innerText = userName;
                setView('setup');
                return;
            }

            setView('home');
            const avatar = meta.avatar_url || `https://ui-avatars.com/api/?name=${userName}&background=0a84ff&color=fff`;

            // Display Name Injection
            document.getElementById('user-display-name').innerText = userName;
            document.getElementById('profile-name-label').innerText = userName;
            document.getElementById('profile-email-label').innerText = user.email;
            
            document.getElementById('header-avatar').src = avatar;
            document.getElementById('modal-avatar').src = avatar;
            
            jumpToSlide(0);
        } else {
            setView('auth');
        }
    });

    function setView(target) {
        Object.values(views).forEach(v => v.classList.remove('active'));
        views[target].classList.add('active');
    }

    function toggleProfile() {
        const m = document.getElementById('profile-modal');
        m.classList.toggle('hidden');
    }

    async function handleSignOut() {
        await _supabase.auth.signOut();
        location.reload();
    }

    document.getElementById('btn-update-name').onclick = async () => {
        const newName = document.getElementById('new-name').value.trim();
        if (!newName) return;
        await _supabase.auth.updateUser({ data: { full_name: newName } });
        location.reload();
    };
</script>
</body>
</html>
