<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>DailyDoseofBCA</title>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-base: #000000;
            --accent-blue: #007aff;
            --glass-bg: rgba(255, 255, 255, 0.04);
            --glass-border: rgba(255, 255, 255, 0.1);
            --liquid-blur: blur(40px);
        }

        body {
            background-color: var(--bg-base);
            color: #ffffff;
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", system-ui;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            opacity: 0.2;
            pointer-events: none;
        }

        .liquid-glass {
            background: var(--glass-bg);
            backdrop-filter: var(--liquid-blur);
            -webkit-backdrop-filter: var(--liquid-blur);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.5);
        }

        .view { position: fixed; inset: 0; display: none; flex-direction: column; z-index: 10; background: black; }
        .view.active { display: flex; }

        .ios-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            padding: 12px;
            color: white;
            font-size: 15px;
            outline: none;
            transition: all 0.3s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .ios-input:focus { border-color: var(--accent-blue); background: rgba(255, 255, 255, 0.08); }

        .ios-btn {
            width: 100%;
            background: var(--accent-blue);
            color: white;
            border-radius: 14px;
            padding: 14px;
            font-weight: 700;
            font-size: 15px;
            transition: all 0.4s cubic-bezier(0.2, 1, 0.3, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .ios-btn:active { transform: scale(0.97); opacity: 0.9; }

        .slider-viewport {
            position: relative;
            overflow: hidden;
            width: 100%;
            touch-action: none;
        }
        .slider-track {
            display: flex;
            height: 100%;
            will-change: transform;
        }
        .slide {
            width: 100vw;
            padding: 0 16px;
            flex-shrink: 0;
        }

        .slide-content {
            padding-bottom: 100px;
        }

        .card-minimal {
            border-radius: 24px;
            padding: 20px;
            height: auto;
        }

        /* Card Lift-Up Effect */
        .card-lift {
            transition: transform 0.4s cubic-bezier(0.2, 1, 0.3, 1), box-shadow 0.4s ease;
        }
        .card-lift:active {
            transform: scale(1.02) translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
            filter: brightness(1.1);
        }

        /* Nav Container Interactive State */
        nav {
            transition: transform 0.3s cubic-bezier(0.2, 1, 0.3, 1);
        }
        nav:active {
            transform: scale(0.98); /* Subtle press effect on whole bar */
        }
        .nav-lift {
            transform: translateY(-8px);
        }

        /* Indicator Drag Styling */
        #nav-indicator {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1), background 0.3s ease;
            will-change: transform;
        }
        
        /* Dragging state for indicator */
        .indicator-active #nav-indicator {
            transform: scale(1.05) translateY(-4px); /* Lift-up feel during drag */
            background: rgba(255, 255, 255, 0.18);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            transition: none; /* Instant tracking during drag */
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading .spinner { display: block; }
        .loading .btn-text { display: none; }

        #setup-name-display {
            background: linear-gradient(90deg, #007aff, #00c6ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body>

    <div class="orb w-[200px] h-[200px] bg-blue-600 top-[-60px] right-[-30px]"></div>
    <div class="orb w-[180px] h-[180px] bg-purple-600 bottom-[-30px] left-[-30px]"></div>

    <!-- AUTHENTICATION VIEW -->
    <div id="view-auth" class="view active items-center justify-center p-6">
        <div class="w-full max-w-[320px] relative z-20">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-black tracking-tighter mb-1">DailyDoseofBCA</h1>
                <p class="text-zinc-500 text-xs font-medium">One place for all your BCA class works.</p>
            </div>
            
            <div class="space-y-2.5">
                <input type="text" id="reg-name" class="ios-input hidden" placeholder="Full Name">
                <input type="email" id="reg-email" class="ios-input" placeholder="Email Address">
                <input type="password" id="reg-pass" class="ios-input" placeholder="Password">
            </div>

            <button id="btn-auth-submit" class="ios-btn mt-5 shadow-lg shadow-blue-500/10">
                <span class="btn-text">Continue</span>
                <div class="spinner"></div>
            </button>
            
            <p id="auth-toggle" class="mt-5 text-xs text-center text-zinc-500 font-bold cursor-pointer">New here? <span class="text-blue-500">Sign Up</span></p>
            <p id="auth-msg" class="mt-3 text-[10px] font-semibold text-center text-red-400 min-h-[1rem]"></p>
        </div>
    </div>

    <!-- SETUP VIEW -->
    <div id="view-setup-pfp" class="view items-center justify-center p-6">
        <div class="w-full max-w-[320px] text-center relative z-20">
            <h1 class="text-xl font-black mb-1">Welcome, <span id="setup-name-display">Student</span>!</h1>
            <p class="text-zinc-500 text-[11px] mb-6">Let's finish your profile.</p>

            <div class="relative inline-block mb-8">
                <div class="w-24 h-24 rounded-[30px] liquid-glass overflow-hidden p-0.5">
                    <img id="setup-pfp-preview" src="https://ui-avatars.com/api/?name=User&background=0a84ff&color=fff" class="w-full h-full object-cover rounded-[28px]">
                </div>
                <input type="file" id="setup-pfp-input" class="hidden" accept="image/*">
                <button onclick="document.getElementById('setup-pfp-input').click()" class="absolute -bottom-1 -right-1 bg-blue-600 p-2.5 rounded-2xl border-2 border-black active:scale-90 transition-transform">
                    <i data-lucide="camera" size="16"></i>
                </button>
            </div>

            <div class="space-y-2.5">
                <button id="btn-setup-finish" class="ios-btn">Finish Setup</button>
                <button id="btn-setup-skip" class="w-full py-2.5 text-zinc-500 font-bold text-[11px]">Skip</button>
            </div>
        </div>
    </div>

    <!-- HOME VIEW -->
    <div id="view-home" class="view">
        <header class="pt-12 px-6 pb-2 flex justify-between items-end relative z-20">
            <div>
                <h2 class="text-xs font-black text-blue-500 uppercase tracking-widest mb-0.5">Workspace</h2>
                <h1 id="user-display-name" class="text-2xl font-black tracking-tighter">Student</h1>
            </div>
            <button onclick="toggleProfile()" class="active:scale-90 transition-transform">
                <img id="header-avatar" src="" class="w-10 h-10 rounded-xl liquid-glass object-cover bg-zinc-900">
            </button>
        </header>

        <div class="slider-viewport flex-1 mt-3" id="slider-viewport">
            <div class="slider-track" id="slider-track">
                
                <div class="slide">
                    <div class="slide-content h-full overflow-y-auto">
                        <h3 class="text-xs font-black text-zinc-600 uppercase tracking-[0.2em] mb-3">Notes</h3>
                        <div class="space-y-3">
                            <div class="liquid-glass card-minimal card-lift border-white/5">
                                <div class="w-10 h-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="smartphone" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">Mobile Application Development</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Development of Android and iOS applications.</p>
                                <a href="https://drive.google.com/file/d/1eqbwVfpe7OvzrVSnUq_1b732fFSEGnXT/view?usp=sharing" target="_blank" class="w-full py-2.5 bg-white text-black rounded-xl font-black text-[10px] text-center block">View PDF</a>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-white/5">
                                <div class="w-10 h-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="cpu" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">Operating System</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Working of operating systems and processes.</p>
                                <a href="https://drive.google.com/file/d/1K-XtFALhVbERRb4TybfZmuRdswTmL7bG/view?usp=sharing" target="_blank" class="w-full py-2.5 bg-white text-black rounded-xl font-black text-[10px] text-center block">View PDF</a>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-white/5">
                                <div class="w-10 h-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="code" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">Python</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Programming with Python language.</p>
                                <a href="https://drive.google.com/file/d/1YO_-FEzv9xf_KgwBtr_M3q4gKd_2nqaz/view?usp=sharing" target="_blank" class="w-full py-2.5 bg-white text-black rounded-xl font-black text-[10px] text-center block">View PDF</a>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-white/5">
                                <div class="w-10 h-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="trending-up" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">Affiliate Marketing</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Strategies and techniques for affiliate marketing.</p>
                                <a href="https://drive.google.com/file/d/1bBNn016vo-gj9mf_7p-CMZaZEP7BV-cD/view?usp=sharing" target="_blank" class="w-full py-2.5 bg-white text-black rounded-xl font-black text-[10px] text-center block">View PDF</a>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-white/5">
                                <div class="w-10 h-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="search" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">Search Engine Optimization</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">What is SEO, how does it work?</p>
                                <a href="https://drive.google.com/file/d/1sTi59Twjk9nyB9n5xlv9JMeWWmH0CFVB/view?usp=sharing" target="_blank" class="w-full py-2.5 bg-white text-black rounded-xl font-black text-[10px] text-center block">View PDF</a>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-white/5">
                                <div class="w-10 h-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="user-check" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">Tutor Guidance</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Guidance and tips for effective tutoring.</p>
                                <a href="https://drive.google.com/file/d/1YhwWJa5rIz2OfO4gp9ZyNkBv94Wm7xmp/view?usp=sharing" target="_blank" class="w-full py-2.5 bg-white text-black rounded-xl font-black text-[10px] text-center block">View PDF</a>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-white/5">
                                <div class="w-10 h-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="atom" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">Nano Technology</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Introduction to nanotechnology and applications.</p>
                                <a href="https://drive.google.com/file/d/1ffuzxWk0w6H7QTpmrchkyPC-gdOe0lXP/view?usp=sharing" target="_blank" class="w-full py-2.5 bg-white text-black rounded-xl font-black text-[10px] text-center block">View PDF</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="slide">
                    <div class="slide-content h-full overflow-y-auto">
                        <h3 class="text-[9px] font-black text-zinc-600 uppercase tracking-[0.2em] mb-3">Assignments</h3>
                        <div class="space-y-3">
                            <div class="liquid-glass card-minimal card-lift border-purple-500/20">
                                <div class="w-10 h-10 bg-purple-500/10 text-purple-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="clipboard-list" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">MAD Assignment</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Topic: Android Studio Installallation</p>
                                <a href="https://www.geeksforgeeks.org/android/guide-to-install-and-set-up-android-studio/" target="_blank" class="w-full py-2.5 bg-zinc-800 text-white rounded-xl font-black text-[10px] border border-white/10 text-center block">Open</a>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-purple-500/20">
                                <div class="w-10 h-10 bg-purple-500/10 text-purple-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="clipboard-list" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">AFM Assignment</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Topic: Types, Advantages and disadvantages of AFM</p>
                                <a href="https://drive.google.com/file/d/1-Ph21Km1u4eMbCy63Ynd_sSeqhOmLN5f/view?usp=drive_link" target="_blank" class="w-full py-2.5 bg-zinc-800 text-white rounded-xl font-black text-[10px] border border-white/10 text-center block">Open</a>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-purple-500/20">
                                <div class="w-10 h-10 bg-purple-500/10 text-purple-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="clipboard-list" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">Python Assignment</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">Topic: String functions</p>
                                <a href="https://drive.google.com/file/d/1LJIpdBy3_PIrWBXv9Dx5lyaJim3TzhQ5/view?usp=drive_link" target="_blank" class="w-full py-2.5 bg-zinc-800 text-white rounded-xl font-black text-[10px] border border-white/10 text-center block">Open</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="slide">
                    <div class="slide-content h-full overflow-y-auto">
                        <h3 class="text-[9px] font-black text-zinc-600 uppercase tracking-[0.2em] mb-3">Records</h3>
                        <div class="space-y-3">
                            <div class="liquid-glass card-minimal card-lift border-emerald-500/20">
                                <div class="w-10 h-10 bg-emerald-500/10 text-emerald-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="database" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">_----_</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">_------_</p>
                                <button class="w-full py-2.5 bg-zinc-800 text-white rounded-xl font-black text-[10px] border border-white/10">Access</button>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-emerald-500/20">
                                <div class="w-10 h-10 bg-emerald-500/10 text-emerald-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="book-marked" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">_----_</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">_------_</p>
                                <button class="w-full py-2.5 bg-zinc-800 text-white rounded-xl font-black text-[10px] border border-white/10">Access</button>
                            </div>
                            <div class="liquid-glass card-minimal card-lift border-emerald-500/20">
                                <div class="w-10 h-10 bg-emerald-500/10 text-emerald-500 rounded-xl flex items-center justify-center mb-4">
                                    <i data-lucide="share2" size="20"></i>
                                </div>
                                <h4 class="text-lg font-bold mb-1">_----_</h4>
                                <p class="text-zinc-500 text-[10px] leading-relaxed mb-6">_------_</p>
                                <button class="w-full py-2.5 bg-zinc-800 text-white rounded-xl font-black text-[10px] border border-white/10">Access</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Interactive Bottom Bar -->
        <div class="fixed bottom-8 left-0 w-full px-5 z-30">
            <nav id="bottom-nav" class="liquid-glass w-full max-w-[320px] mx-auto h-14 rounded-[22px] flex items-center p-1 relative overflow-visible cursor-grab active:cursor-grabbing">
                <div id="nav-indicator" class="absolute h-[calc(100%-8px)] w-[calc((100%-8px)/3)] rounded-[18px] z-0"></div>
                
                <div class="flex-1 h-full flex flex-col items-center justify-center z-10" onclick="jumpToSlide(0)">
                    <i data-lucide="book-open" size="16"></i>
                    <span class="text-xs mt-1">Notes</span>
                </div>
                <div class="flex-1 h-full flex flex-col items-center justify-center z-10 opacity-40" onclick="jumpToSlide(1)">
                    <i data-lucide="clipboard-list" size="16"></i>
                    <span class="text-xs mt-1">Assignments</span>
                </div>
                <div class="flex-1 h-full flex flex-col items-center justify-center z-10 opacity-40" onclick="jumpToSlide(2)">
                    <i data-lucide="database" size="16"></i>
                    <span class="text-xs mt-1">Records</span>
                </div>
            </nav>
        </div>
    </div>

    <!-- PROFILE MODAL -->
    <div id="profile-modal" class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-xl flex items-end justify-center" onclick="toggleProfile()">
        <div class="w-full liquid-glass rounded-t-[32px] p-6 animate-slide-up" onclick="event.stopPropagation()">
            <div class="w-8 h-1 bg-white/10 rounded-full mx-auto mb-6"></div>
            <div class="flex items-center gap-4 mb-8">
                <img id="modal-avatar" src="" class="w-14 h-14 rounded-2xl object-cover border border-blue-500/30 bg-zinc-900">
                <div>
                    <h3 id="profile-name-label" class="text-lg font-bold">User</h3>
                    <p id="profile-email-label" class="text-zinc-500 text-[10px]">user@email.com</p>
                </div>
            </div>
            <div class="space-y-2.5">
                <div class="flex gap-2">
                    <input type="text" id="new-name" class="ios-input flex-1" placeholder="Rename">
                    <button id="btn-update-name" class="bg-white text-black px-5 rounded-xl font-bold text-[11px]">Save</button>
                </div>
                <button onclick="handleSignOut()" class="w-full py-3 bg-red-500/10 text-red-500 rounded-xl font-bold text-[11px]">Sign Out</button>
            </div>
        </div>
    </div>

<script>
    lucide.createIcons();
    const SB_URL = 'https://nsvkbxssnjjwhsrsxirs.supabase.co'; 
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zdmtieHNzbmpqd2hzcnN4aXJzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0MDA4NzksImV4cCI6MjA4MTk3Njg3OX0.S5GgEm49x6nJFmnOSsFI3Nte-mwNmVUbwTkxqa8h3yE';
    const _supabase = supabase.createClient(SB_URL, SB_KEY);

    const views = {
        auth: document.getElementById('view-auth'),
        setup: document.getElementById('view-setup-pfp'),
        home: document.getElementById('view-home')
    };

    let isLoginMode = true;
    let currentSlide = 0;
    const totalSlides = 3;

    const track = document.getElementById('slider-track');
    const viewport = document.getElementById('slider-viewport');
    const navBar = document.getElementById('bottom-nav');
    const indicator = document.getElementById('nav-indicator');

    let touchStartX = 0;
    let isSwiping = false;

    // --- LIQUID 1:1 CONTENT DRAG ---
    viewport.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
        isSwiping = true;
        track.style.transition = 'none';
        indicator.style.transition = 'none';
    }, { passive: true });

    viewport.addEventListener('touchmove', (e) => {
        if (!isSwiping) return;
        const touchX = e.touches[0].clientX;
        const diff = touchX - touchStartX;
        const screenWidth = window.innerWidth;
        const offset = (currentSlide * -screenWidth) + diff;
        
        track.style.transform = `translateX(${offset}px)`;
        const swipeProgress = diff / screenWidth;
        const indicatorProgress = currentSlide - swipeProgress;
        indicator.style.transform = `translateX(${indicatorProgress * 100}%)`;
    }, { passive: true });

    viewport.addEventListener('touchend', (e) => {
        if (!isSwiping) return;
        isSwiping = false;
        const touchEndX = e.changedTouches[0].clientX;
        const diff = touchEndX - touchStartX;
        const threshold = window.innerWidth / 5;

        if (diff < -threshold && currentSlide < totalSlides - 1) currentSlide++;
        else if (diff > threshold && currentSlide > 0) currentSlide--;
        
        jumpToSlide(currentSlide);
    });

    // --- BOTTOM NAV DRAG ENGINE ---
    let navStartX = 0;
    let isNavDragging = false;

    navBar.addEventListener('touchstart', (e) => {
        isNavDragging = true;
        navStartX = e.touches[0].clientX;
        navBar.classList.add('indicator-active', 'nav-lift');
        indicator.style.transition = 'none';
        track.style.transition = 'none';
    }, { passive: true });

    navBar.addEventListener('touchmove', (e) => {
        if (!isNavDragging) return;
        const rect = navBar.getBoundingClientRect();
        const touchX = e.touches[0].clientX;
        const relativeX = touchX - rect.left - (rect.width / 6); // Offset to center indicator
        
        const navProgress = relativeX / (rect.width / 3);
        const clampedProgress = Math.max(0, Math.min(2, navProgress));
        
        indicator.style.transform = `translateX(${clampedProgress * 100}%)`;
        track.style.transform = `translateX(${clampedProgress * -window.innerWidth}px)`;
    }, { passive: true });

    navBar.addEventListener('touchend', (e) => {
        if (!isNavDragging) return;
        isNavDragging = false;
        navBar.classList.remove('indicator-active', 'nav-lift');

        const rect = navBar.getBoundingClientRect();
        const touchX = e.changedTouches[0].clientX;
        const relativeX = touchX - rect.left;
        const targetIndex = Math.round((relativeX / rect.width) * 3 - 0.5);

        currentSlide = Math.max(0, Math.min(2, targetIndex));
        jumpToSlide(currentSlide);
    });

    function jumpToSlide(index) {
        currentSlide = index;
        const width = window.innerWidth;
        track.style.transition = 'transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)';
        indicator.style.transition = 'transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)';
        track.style.transform = `translateX(${index * -width}px)`;
        indicator.style.transform = `translateX(${index * 100}%)`;
        
        const navIcons = document.querySelectorAll('nav div:not(#nav-indicator)');
        navIcons.forEach((el, i) => {
            el.style.opacity = (i === index ? '1' : '0.4');
        });
    }

    // --- SUPABASE & AUTH ---
    document.getElementById('auth-toggle').onclick = () => {
        isLoginMode = !isLoginMode;
        document.getElementById('auth-title').innerText = isLoginMode ? "DailyDose" : "Join Us";
        document.getElementById('auth-toggle').innerHTML = isLoginMode ? 'New here? <span class="text-blue-500">Sign Up</span>' : 'Already have an account? <span class="text-blue-500">Log In</span>';
        document.getElementById('reg-name').classList.toggle('hidden', isLoginMode);
    };

    document.getElementById('btn-auth-submit').onclick = async () => {
        const btn = document.getElementById('btn-auth-submit');
        const email = document.getElementById('reg-email').value.trim();
        const password = document.getElementById('reg-pass').value;
        const name = document.getElementById('reg-name').value.trim();
        const msg = document.getElementById('auth-msg');
        if (!email || !password || (!isLoginMode && !name)) return msg.innerText = "Fill all fields.";
        btn.classList.add('loading');
        if (isLoginMode) {
            const { error } = await _supabase.auth.signInWithPassword({ email, password });
            if (error) { msg.innerText = error.message; btn.classList.remove('loading'); }
        } else {
            const { data, error } = await _supabase.auth.signUp({
                email, password, options: { data: { full_name: name, profile_changes_left: 5 } }
            });
            if (error) { msg.innerText = error.message; btn.classList.remove('loading'); }
            else if (!data.session) { msg.innerText = "Check email!"; btn.classList.remove('loading'); }
        }
    };

    document.getElementById('btn-setup-finish').onclick = async () => {
        const file = document.getElementById('setup-pfp-input').files[0];
        if (!file) return alert("Select a photo.");
        const btn = document.getElementById('btn-setup-finish');
        btn.innerText = "Updating...";
        const { data: { user } } = await _supabase.auth.getUser();
        const path = `avatars/${user.id}-${Date.now()}`;
        await _supabase.storage.from('avatars').upload(path, file);
        const { data: { publicUrl } } = _supabase.storage.from('avatars').getPublicUrl(path);
        await _supabase.auth.updateUser({ data: { avatar_url: publicUrl } });
        location.reload();
    };

    document.getElementById('btn-setup-skip').onclick = () => setView('home');

    _supabase.auth.onAuthStateChange(async (event, session) => {
        if (session) {
            const user = session.user;
            const meta = user.user_metadata || {};
            const userName = meta.full_name || "Student";
            if (!meta.avatar_url && !views.home.classList.contains('active')) {
                document.getElementById('setup-name-display').innerText = userName;
                setView('setup'); return;
            }
            setView('home');
            const avatar = meta.avatar_url || `https://ui-avatars.com/api/?name=${userName}&background=0a84ff&color=fff`;
            document.getElementById('user-display-name').innerText = userName;
            document.getElementById('profile-name-label').innerText = userName;
            document.getElementById('profile-email-label').innerText = user.email;
            document.getElementById('header-avatar').src = avatar;
            document.getElementById('modal-avatar').src = avatar;
            jumpToSlide(0);
        } else { setView('auth'); }
    });

    function setView(target) {
        Object.values(views).forEach(v => v.classList.remove('active'));
        views[target].classList.add('active');
    }

    function toggleProfile() {
        document.getElementById('profile-modal').classList.toggle('hidden');
    }

    async function handleSignOut() {
        await _supabase.auth.signOut();
        location.reload();
    }

    window.addEventListener('resize', () => jumpToSlide(currentSlide));
</script>
</body>
</html>
